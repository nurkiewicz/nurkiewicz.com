---
layout: post
title: Automatically generating WADL in Spring MVC REST application
date: '2012-02-02T22:21:00.000+01:00'
author: Tomasz Nurkiewicz
tags:
- wadl
- spring mvc
- rest
- spring
- soapui
modified_time: '2013-04-25T19:41:55.308+02:00'
thumbnail: http://3.bp.blogspot.com/-sgGRFYpL890/Tyr6DsAUerI/AAAAAAAAAhE/UPHr0Zc27qo/s72-c/debugger.png
blogger_id: tag:blogger.com,1999:blog-6753769565491687768.post-412192320809667660
blogger_orig_url: https://www.nurkiewicz.com/2012/02/automatically-generating-wadl-in-spring.html
---

Last time we have learnt <a href="http://nurkiewicz.blogspot.no/2012/01/gentle-introduction-to-wadl-in-java.html">the basics of WADL</a>. The language itself is not as interesting to write a separate article about it, but the title of this article reveals why we needed that knowledge.<br /><br />Many implementations of <a href="http://jcp.org/en/jsr/detail?id=311">JSR 311: JAX-RS: The Java API for RESTful Web Services</a> provide runtime WADL generation out-of-the-box: <a href="http://cxf.apache.org/docs/jax-rs.html#JAX-RS-ServicelistingsandWADLsupport">Apache CXF</a>, <a href="https://wikis.oracle.com/display/Jersey/WADL">Jersey</a> and <a href="http://wiki.restlet.org/docs_2.0/72-restlet.html">Restlet</a>. <a href="https://issues.jboss.org/browse/RESTEASY-166">RESTeasy</a> still waiting. Basically these frameworks examine Java code with JSR-311 annotations and generate WADL document available under some URL. Unfortunately Spring MVC not only does not implement the JSR-311 standard (see: <a href="http://stackoverflow.com/questions/7518391">Does Spring MVC support JSR 311 annotations?</a>), but it also does not generate WADL for us (see: <a href="https://jira.springsource.org/browse/SPR-8705">SPR-8705</a>), even though it is perfectly suited for exposing REST services.<br /><br />For various reasons I started developing server-side REST services with Spring MVC and after a while (say, thirdy resources later) I started to get a bit lost. I really needed a way to catalogue and document all available resources and operations. WADL seemed like a great choice.<br /><br />Fortunately Spring framework is open for extension and it is easy to add new features based on existing infrastructure if you are willing to dig through the code for a while. In order to generate WADL I needed a list of URIs that an application handles, what HTTP methods are implemented and – ideally – which Java method handles each one of them. Obviously Spring does that job already somewhere during boot-strapping MVC <code>DispatcherServlet</code> - scanning for <code>@Controller</code>, <code>@RequestMapping</code>, <code>@PathVariable</code>, etc. - so it seems smart to reuse that information rather then performing the job again.<br /><br />Guess what, it looks like all the information we need is kept in an oddly named <a href="http://static.springsource.org/spring/docs/current/api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html"><code>RequestMappingHandlerMapping</code></a> class. Here is a debugger screenshot just to give you an overview how rich information is available:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-sgGRFYpL890/Tyr6DsAUerI/AAAAAAAAAhE/UPHr0Zc27qo/s1600/debugger.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="186" src="http://3.bp.blogspot.com/-sgGRFYpL890/Tyr6DsAUerI/AAAAAAAAAhE/UPHr0Zc27qo/s400/debugger.png" width="400" /></a></div><br />But it gets even better: <code>RequestMappingHandlerMapping</code> is actually a Spring bean which you can easily inject and use:<br /><a name='more'></a><br /><pre class="brush: scala">@Controller<br />class WadlController @Autowired()(mapping: RequestMappingHandlerMapping) {<br /><br />    @RequestMapping(method = Array(GET))<br />    @ResponseBody def generate(request: HttpServletRequest) = new WadlApplication()<br /><br />}</pre>That's right, we will use yet another Spring MVC controller to generate WADL document. <a href="http://nurkiewicz.com/2012/01/gentle-introduction-to-wadl-in-java.html">Last time</a> we managed to generate JAXB classes representing WADL document (after all WADL is an XML file) so by returning empty instance of <code>WadlApplication</code> we are actually returning empty, but valid WADL:<br /><pre class="brush: xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br />&lt;application xmlns="http://wadl.dev.java.net/2009/02"/&gt;</pre>I won't explain the details of the implementation (<a href="https://github.com/nurkiewicz/spring-rest-wadl">full source code</a> is available including sample application). It was basically a matter of rewriting Spring models to WADL classes. If you are interested, have a look at <a href="https://github.com/nurkiewicz/spring-rest-wadl/blob/master/generator/src/main/scala/com/blogspot/nurkiewicz/springwadl/WadlGenerator.scala"><code>WadlGenerator.scala</code></a> that is a central point of the solution and <a href="https://github.com/nurkiewicz/spring-rest-wadl/blob/master/generator/src/test/scala/com/blogspot/nurkiewicz/springwadl/WadlGeneratorTest.scala">test cases</a>. Here is one of them:  <br /><pre class="brush: scala">test("should add parameter info for template parameter in URL") {<br />    given("")<br />    val mapping = Map(<br />        mappingInfo("/books", GET) -&gt; handlerMethod("listBooks"),<br />        mappingInfo("/books/{bookId}", GET) -&gt; handlerMethod("readBook")<br />    )<br /><br />    when("")<br />    val wadl = generate(mapping)<br /><br />    then("")<br />    assertXMLEqual(wadlHeader + """<br />        &lt;resource path="books"&gt;<br />            &lt;method name="GET"&gt;<br />                &lt;doc title="com.blogspot.nurkiewicz.springwadl.TestController.listBooks"/&gt;<br />            &lt;/method&gt;<br />            &lt;resource path="{bookId}"&gt;<br />                &lt;param name="bookId" required="true" /&gt;<br />                &lt;method name="GET"&gt;<br />                    &lt;doc title="com.blogspot.nurkiewicz.springwadl.TestController.readBook"/&gt;<br />                &lt;/method&gt;<br />            &lt;/resource&gt;<br />        &lt;/resource&gt;<br />    """ + wadlFooter, wadl)<br />}<br /></pre>Unfortunately I was too lazy to correctly name <code>given/when/then</code> blocks. But tests should be pretty readable.<br /><br />The only technical difficulty I would like to mention was translating flat URI patterns provided by Spring infrastructure to hierarchical WADL objects (basically a tree). Here is a simplified version of this problem: having a list of URI patterns as follows: <br /><pre class="brush: plain">/books<br />/books/{bookId}<br />/books/{bookId}/reviews<br />/books/best-sellers<br />/readers<br />/readers/{readerId}<br />/readers/{readerId}/account/new-password<br />/readers/active<br />/readers/passive<br /></pre>Generate the following tree data structure:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-K0dKUU7hOgE/Tyr6Pe9mcwI/AAAAAAAAAhQ/oAFiMeuVBh4/s1600/resources.gif" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="289" src="http://4.bp.blogspot.com/-K0dKUU7hOgE/Tyr6Pe9mcwI/AAAAAAAAAhQ/oAFiMeuVBh4/s400/resources.gif" width="400" /></a></div><br />Of course the data structure is as simple as a <code>Node</code> object holding a label and a <code>children</code> list of <code>Node</code>s. Not really that challenging, but probably an interesting <a href="http://codekata.pragprog.com/">CodeKata</a>.<br /><br />So what is it all about with this WADL? Is the XML really more readable and helps in managing REST-heavy applications? I wouldn't even bother playing with it if not the great soapUI <a href="http://www.soapui.org/REST-Testing/working-with-rest-services.html">support for WADL</a>. The WADL generated for an <a href="https://github.com/nurkiewicz/spring-rest-wadl/tree/master/showcase">example application</a> I pushed as well can be easily imported to soapUI:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-dAGg_xsVhlc/Tyr6U3rsgII/AAAAAAAAAhc/iBSy9_5Pp-I/s1600/soapui.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="237" src="http://4.bp.blogspot.com/-dAGg_xsVhlc/Tyr6U3rsgII/AAAAAAAAAhc/iBSy9_5Pp-I/s400/soapui.png" width="400" /></a></div><br />Two features are worth mentioning. First of all soapUI displays a <b>tree</b> of REST resources (as opposed to flat list of operations when WSDL is imported). Next to every HTTP method there is a corresponding Java method that handles it (this can be disabled) for troubleshooting and debugging purposes. Secondly, we can pick any HTTP method/resource and invoke it. Based on WADL description soapUI will create user-friendly wizard where one can input parameters. Default values are automatically populated. When we are done, the application will generate HTTP request with correct URL and content, displaying the response when it arrives. Really helpful!<br /><br />By the way have you noticed the <code>max</code> and <code>page</code> query parameters? Our small library uses reflection to find <code>@RequestParam</code> annotations so e.g. the following controller:  <br /><pre class="brush: scala; highlight: [7,8]">@Controller<br />@RequestMapping(value = Array("/book/{bookId}/review"))<br />class ReviewController @Autowired()(reviewService: ReviewService) {<br /><br />    @RequestMapping(method = Array(GET))<br />    @ResponseBody def listReviews(<br />            @RequestParam(value = "page", required = false, defaultValue = "1") page: Int,<br />            @RequestParam(value = "max", required = false, defaultValue = "20") max: Int) =<br />        new ResultPage(reviewService.listReviews(new PageRequest(page - 1, max)))<br /><br />    //...<br /><br />}<br /></pre>will be translated into WADL-compatible description:  <br /><pre class="brush: xml; highlight: [8, 14, 15]">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;<br />&lt;application xmlns="http://wadl.dev.java.net/2009/02"&gt;<br />  &lt;doc title="Spring MVC REST appllication"/&gt;<br />  &lt;resources base="http://localhost:8080/api"&gt;<br />    &lt;resource path="book"&gt;<br />      &lt;!-- --&gt;<br />      &lt;resource path="{bookId}"&gt;<br />        &lt;param required="true" style="template" name="bookId"/&gt;<br />        &lt;!-- --&gt;<br />        &lt;resource path="review"&gt;<br />          &lt;method name="GET"&gt;<br />            &lt;doc title="com.blogspot.nurkiewicz.web.ReviewController.listReviews"/&gt;<br />            &lt;request&gt;<br />              &lt;param required="false" default="1" style="query" name="page"/&gt;<br />              &lt;param required="false" default="20" style="query" name="max"/&gt;<br />            &lt;/request&gt;<br />        &lt;/resource&gt;<br />      &lt;/resource&gt;<br />    &lt;/resource&gt;<br />  &lt;/resource<br />&lt;/application&gt;<br /></pre>Hope you had fun with this small library I have written. Feel free to include it in your project and don't hesitate to report bugs. Full source code  under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache license</a> is available on GitHub: <a href="https://github.com/nurkiewicz/spring-rest-wadl">https://github.com/nurkiewicz/spring-rest-wadl</a>.