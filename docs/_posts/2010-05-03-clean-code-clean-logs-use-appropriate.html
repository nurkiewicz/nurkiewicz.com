---
layout: post
title: 'Clean code, clean logs: use appropriate tools (1/10)'
date: '2010-05-03T23:28:00.007+02:00'
author: Tomasz Nurkiewicz
tags:
- log4j
- logging
- logback
- perf4j
- slf4j
modified_time: '2010-05-20T18:35:10.249+02:00'
blogger_id: tag:blogger.com,1999:blog-6753769565491687768.post-8428375307768807754
blogger_orig_url: https://www.nurkiewicz.com/2010/05/clean-code-clean-logs-use-appropriate.html
---

Many programmers seem to forget how logging application behavior and its current activity is important. When somebody puts:<br /><br /><pre class="brush: java">log.info("!@#$%");</pre><br /><br />happily somewhere in the code, he probably don't realize the importance of  application logs during maintenance, tuning and failure identification. Underestimating the value of good logs is a terrible mistake. I have collected few random advices that I find especially useful when it comes to writing logging routines and I will present them in a series of short articles. First tip (out of ten) is about logging libraries and tools.<br /><br />In my opinion, <a href="http://www.slf4j.org/">SLF4J</a> is the best logging API available, mostly because of a great pattern substitution support:<br /><br /><pre class="brush: java">log.debug("Found {} records matching filter: '{}'", records, filter);</pre><br /><br />In Log4j you would have to use:<br /><br /><pre class="brush: java">log.debug("Found " + records + " records matching filter: '" + filter + "'");</pre><br /><br />This is not only longer and less readable, but also inefficient because of extensive use of string concatenation. SLF4J adds nice {} substitution feature. Also, because string concatenation is avoided and toString() is not called if the logging statement is filtered, there is no need for isDebugEnabled() anymore. BTW, have you noticed <a href="http://www.javapractices.com/topic/TopicAction.do?Id=204">single quotes</a> around filter string parameter?<br /><br />SLF4J is just a façade, as an implementation I would recommend <a href="http://logback.qos.ch/">Logback</a> framework, <a href="http://nurkiewicz.com/2010/01/logback-feed-publish-your-application.html">already advertised</a> on my blog, instead of well established <a href="http://logging.apache.org/log4j/1.2">Log4J</a>. It has many interesting features (some of them will be discussed in future tips) and, <a href="http://logging.apache.org/log4j/1.2/changes-report.html">in contrary</a> to Log4J, is actively developed.<br /><br />The last tool to recommend is <a href="http://perf4j.codehaus.org/">Perf4J</a>. To quote their motto:<br /><br /><span style="font-style: italic;">Perf4J is to System.currentTimeMillis() as log4j is to System.out.println()</span><br /><br />I've added Perf4J to one existing application under heavy load and seen it in action in few other. Both administrators and business users were impressed by the nice graphs produced by this simple utility. Also we were able to discover performance flaws in no time. Perf4J itself deserves its own article, but for now just check their <a href="http://perf4j.codehaus.org/devguide.html">Developer Guide</a>.<br /><br />To summarize, this is the ideal pom.xml excerpt to start with:<br /><br /><pre class="brush: xml">&lt;repositories&gt;<br />    &lt;repository&gt;<br />        &lt;id&gt;Version99&lt;/id&gt;<br />        &lt;name&gt;Version 99 Does Not Exist Maven repository&lt;/name&gt;<br />        &lt;layout&gt;default&lt;/layout&gt;<br />        &lt;url&gt;http://no-commons-logging.zapto.org/mvn2&lt;/url&gt;<br />    &lt;/repository&gt;<br />&lt;/repositories&gt;<br /><br /><br />&lt;dependency&gt;<br />    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;<br />    &lt;version&gt;1.5.11&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br />    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;<br />    &lt;version&gt;0.9.20&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />    &lt;artifactId&gt;jul-to-slf4j&lt;/artifactId&gt;<br />    &lt;version&gt;1.5.11&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />    &lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;<br />    &lt;version&gt;1.5.11&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />    &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;<br />    &lt;version&gt;1.5.11&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />    &lt;groupId&gt;commons-logging&lt;/groupId&gt;<br />    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;<br />    &lt;version&gt;99.0-does-not-exist&lt;/version&gt;<br />&lt;/dependency&gt;</pre><br /><br />To test this, try the following code:<br /><br /><pre class="brush: java">SLF4JBridgeHandler.install();<br /><br />org.apache.log4j.Logger.getLogger("A").info("Log4J");<br />java.util.logging.Logger.getLogger("B").info("java.util.logging");<br />org.apache.commons.logging.LogFactory.getLog("C").info("commons-logging");<br />org.slf4j.LoggerFactory.getLogger("D").info("Logback via SLF4J");</pre><br /><br />As you can see, no matter which logging framework is used (we don't even have Log4J and <a href="http://commons.apache.org/logging">Commons-Logging</a> on our <span style="font-family:courier new;">CLASSPATH</span>, see <a href="http://day-to-day-stuff.blogspot.com/2007/10/announcement-version-99-does-not-exist.html">99.0-does-not-exist</a> version!), every logging statement is printed using Logback (see <a href="http://www.slf4j.org/legacy.html">how it works</a>). So even if your favorite libraries stick to Commons-Logging (very bad thing! <a href="http://articles.qos.ch/thinkAgain.html">[1]</a>, <a href="http://articles.qos.ch/classloader.html">[2]</a>) or even worse to Log4J, you don't need to include them in your project.<br /><br /><br />UPDATE: <a href="http://ceki.blogspot.com">Ceki Gülcü</a> (founder of the <a href="http://logging.apache.org/log4j">Log4J</a>, <a href="http://www.slf4j.org">SLF4J</a> and <a href="http://logback.qos.ch">Logback</a> projects) suggested simplier approach to get rid of <a href="http://commons.apache.org/logging">commons-logging</a> dependency (see his <a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-use-appropriate.html?showComment=1272961561168#c8834760945959609553">comment</a>).<br /><br /><br /><ul><br /><li>Clean code, clean logs: use appropriate tools (1/10)</li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-logging-levels.html">Clean code, clean logs: logging levels are there for you (2/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-do-you-know-what.html">Clean code, clean logs: do you know what you are logging? (3/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-avoid-side.html">Clean code, clean logs: avoid side effects (4/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-concise-and.html">Clean code, clean logs: concise and descriptive (5/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-tune-your-pattern.html">Clean code, clean logs: tune your pattern (6/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-log-method.html">Clean code, clean logs: log method arguments and return values (7/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-watch-out-for.html">Clean code, clean logs: watch out for external systems (8/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-log-exceptions.html">Clean code, clean logs: log exceptions properly (9/10)</a></li><br /><li><a href="http://nurkiewicz.com/2010/05/clean-code-clean-logs-easy-to-read-easy.html">Clean code, clean logs: easy to read, easy to parse (10/10)</a></li><br /></ul>