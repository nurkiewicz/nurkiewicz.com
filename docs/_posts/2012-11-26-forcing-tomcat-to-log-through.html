---
layout: post
title: Forcing Tomcat to log through SLF4J/Logback
date: '2012-11-26T19:27:00.000+01:00'
author: Tomasz Nurkiewicz
tags:
- logging
- logback
- slf4j
- tomcat
modified_time: '2012-11-26T21:25:50.755+01:00'
thumbnail: http://3.bp.blogspot.com/-MseDSvPmzwU/ULKJRLAg5HI/AAAAAAAAArU/_MHefl__160/s72-c/100_8300.JPG
blogger_id: tag:blogger.com,1999:blog-6753769565491687768.post-3118040014421258872
blogger_orig_url: https://www.nurkiewicz.com/2012/11/forcing-tomcat-to-log-through.html
---

<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-MseDSvPmzwU/ULKJRLAg5HI/AAAAAAAAArU/_MHefl__160/s1600/100_8300.JPG" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="240" src="http://3.bp.blogspot.com/-MseDSvPmzwU/ULKJRLAg5HI/AAAAAAAAArU/_MHefl__160/s320/100_8300.JPG" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">TusenFryd Amusement Park</td></tr></tbody></table>So you have your <a href="http://nurkiewicz.com/2012/11/standalone-web-application-with.html">executable web application in JAR with bundled Tomcat</a> (make sure to read that one first). However there are these annoying Tomcat logs at the beginning, independent from our application logs and not customizable:<br /><br /><pre class="brush: xml">Nov 24, 2012 11:44:02 PM org.apache.coyote.AbstractProtocol init<br />INFO: Initializing ProtocolHandler ["http-bio-8080"]<br />Nov 24, 2012 11:44:02 PM org.apache.catalina.core.StandardService startInternal<br />INFO: Starting service Tomcat<br />Nov 24, 2012 11:44:02 PM org.apache.catalina.core.StandardEngine startInternal<br />INFO: Starting Servlet Engine: Apache Tomcat/7.0.30<br />Nov 24, 2012 11:44:05 PM org.apache.coyote.AbstractProtocol start<br />INFO: Starting ProtocolHandler ["http-bio-8080"]<br /></pre>I would really like to quite them down, or even better save them somewhere since they sometimes reveal important failures. But I definitely don't want to have a separate <code>java.util.logging</code> configuration. Did you wonder after reading the <a href="http://nurkiewicz.com/2012/11/standalone-web-application-with.html">previous article</a> how did I knew that runnable Tomcat JAR supports <code>-httpPort</code> parameter and few others? Well, I checked the sources, but it's simpler to just ask for help:<br /><br /><pre class="brush: xml">$ java -jar target/standalone.jar -help<br />usage: java -jar [path to your exec war jar]<br /> -ajpPort &lt;ajpPort&gt;                     ajp port to use<br /> -clientAuth                            enable client authentication for<br />                                        https<br /> -D &lt;arg&gt;                               key=value<br /> -extractDirectory &lt;extractDirectory&gt;   path to extract war content,<br />                                        default value: .extract<br /> -h,--help                              help<br /> -httpPort &lt;httpPort&gt;                   http port to use<br /> -httpProtocol &lt;httpProtocol&gt;           http protocol to use: HTTP/1.1 or<br />                                        org.apache.coyote.http11.Http11Nio<br />                                        Protocol<br /> -httpsPort &lt;httpsPort&gt;                 https port to use<br /> -keyAlias &lt;keyAlias&gt;                   alias from keystore for ssl<br /> -loggerName &lt;loggerName&gt;               logger to use: slf4j to use slf4j<br />                                        bridge on top of jul<br /> -obfuscate &lt;password&gt;                  obfuscate the password and exit<br /> -resetExtract                          clean previous extract directory<br /> -serverXmlPath &lt;serverXmlPath&gt;         server.xml to use, optional<br /> -uriEncoding &lt;uriEncoding&gt;             connector uriEncoding default<br />                                        ISO-8859-1<br /> -X,--debug                             debug<br /></pre>The <code>-loggerName</code> parameter looks quite promising. First try:<br /><a name='more'></a><br /><br /><pre class="brush: bash">$ java -jar target/standalone.jar -loggerName slf4j<br />WARNING: issue configuring slf4j jul bridge, skip it<br /></pre>No good. Quick look at the source code again and it turns out that SLF4J library is missing. Since this parameter is interpreted during Tomcat bootstrapping (way before web application is deployed), <code>slf4j-api.jar</code> inside my web application is not enough, it has to be available for root class loader (equivalent to <code>/lib</code> directory in packaged Tomcat). Luckily plugin exposes <a href="http://tomcat.apache.org/maven-plugin-2.0/tomcat7-maven-plugin/exec-war-only-mojo.html#extraDependencies"><code>&lt;extraDependencies/&gt;</code> configuration parameter</a>:<br /><br /><pre class="brush: xml">&lt;configuration&gt;<br />    &lt;path&gt;/standalone&lt;/path&gt;<br />    &lt;enableNaming&gt;false&lt;/enableNaming&gt;<br />    &lt;finalName&gt;standalone.jar&lt;/finalName&gt;<br />    &lt;charset&gt;utf-8&lt;/charset&gt;<br />    &lt;extraDependencies&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;<br />            &lt;version&gt;1.7.2&lt;/version&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />            &lt;artifactId&gt;jul-to-slf4j&lt;/artifactId&gt;<br />            &lt;version&gt;1.7.2&lt;/version&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br />            &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;<br />            &lt;version&gt;1.0.7&lt;/version&gt;<br />        &lt;/dependency&gt;<br />        &lt;dependency&gt;<br />            &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;<br />            &lt;artifactId&gt;logback-core&lt;/artifactId&gt;<br />            &lt;version&gt;1.0.7&lt;/version&gt;<br />        &lt;/dependency&gt;<br />    &lt;/extraDependencies&gt;<br />&lt;/configuration&gt;<br /></pre>Running Tomcat and... success!<br /><br /><pre class="brush: xml">00:01:27.110 [main] INFO  o.a.coyote.http11.Http11Protocol - Initializing ProtocolHandler ["http-bio-8080"]<br />00:01:27.127 [main] INFO  o.a.catalina.core.StandardService - Starting service Tomcat<br />00:01:27.128 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet Engine: Apache Tomcat/7.0.33<br />00:01:29.645 [main] INFO  o.a.coyote.http11.Http11Protocol - Starting ProtocolHandler ["http-bio-8080"]<br /></pre>Well, not quite. If you use <a href="http://logback.qos.ch/">Logback</a> on a daily basis you are familiar with default console logging pattern. We are not picking up any <code>logback.xml</code>. From my experience it seems that placing <code>logback.xml</code> externally somewhere in your file system is superior to putting it inside your binary, especially with auto refreshing feature turned on:<br /><br /><pre class="brush: xml">&lt;configuration scan="true" scanPeriod="5 seconds"&gt;<br />    &lt;!-- ... --&gt;<br />&lt;/configuration&gt;<br /></pre>Put some fallback <code>logback.xml</code> file in the root of your CLASSPATH in case no other file was specified like below and voil√†:<br /><br /><pre class="brush: bash">$ java -jar standalone.jar -httpPort=8081 -loggerName=slf4j \<br />    -Dlogback.configurationFile=/etc/foo/logback.xml<br /></pre>Finally, clean and consistent logging, most likely to a single file.    <script src="https://raw.github.com/gist/3983275/936845e66d98bb7c627684df7884f33b2cc368f5/syntaxhighlighter.js"></script>